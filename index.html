<!DOCTYPE html>
<html>

<head>

    <title>Login</title>

    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="index.css">

    
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-database.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyB2O8pk2xx8HkCoFLwL5v2Ln_b4Q63OW8k",
            authDomain: "website-b059f.firebaseapp.com",
            databaseURL: "https://website-b059f.firebaseio.com",
            projectId: "website-b059f",
            storageBucket: "website-b059f.appspot.com",
            messagingSenderId: "1079994940223"
        };
        firebase.initializeApp(config);
        // database variable.
        var database = firebase.database();
        data = database.ref().child('users')

    </script>

</head>

<body>
    <div class='heading'>
        <h2>
            Welcome to Movie MatchMaker
        </h2>
    </div>

    <div class='welcome_text'>
        <p>

            We select the perfect movie for your entertainment based on your personality and taste.

        </p>
    </div>


    <div class='login'>
        <div id="login_div" class="main-div">
            <h3>Login to your account</h3>
            <input type="email" placeholder="Email..." id="email_field" />
            <input type="password" placeholder="Password..." id="password_field" />

            <button onclick="login()">Login to Account</button>
            <button onclick="create_user()">Sign up</button>
            <p id='invalid_pass'>

            </p>
        </div>
    </div>






</body>



<script>


    function login() {

        var userEmail = document.getElementById("email_field").value;
        var userPass = document.getElementById("password_field").value;

        firebase.auth().signInWithEmailAndPassword(userEmail, userPass).catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            wrong_user_pass()

            // window.alert("Error : " + errorMessage + errorCode);

            // ...
        });
    }

    function logout() {
        firebase.auth().signOut();
    }

    function create_user() {
        var userEmail = document.getElementById("email_field").value;
        var userPass = document.getElementById("password_field").value;

        firebase.auth().createUserWithEmailAndPassword(userEmail, userPass).catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;

            if (errorCode == 'auth/invalid-email') {
                invalid_email()
            }
            if (errorCode == 'auth/email-already-in-use') {
                taken_email()
            }
            if (errorCode == 'auth/weak-password'){
                weak_password()
            }
            
            console.log(errorCode)

            // ...
        });

        

    }

    // var email = ''
    var user = firebase.auth().currentUser;
    var name, email, photoUrl, uid, emailVerified, token;

    firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
            //     email = user.email

            console.log(user.email)
            



            if (user != null) {
                name = user.displayName;
                email = user.email;
                photoUrl = user.photoURL;
                emailVerified = user.emailVerified;
                uid = user.uid;
                // token = user.getToken() // The user's ID, unique to the Firebase project. Do NOT use
                // this value to authenticate with your backend server, if
                // you have one. Use User.getToken() instead.
            }

            // firebase.database().ref().child('users/' + uid).set({
            //     rating: 0
            // });
            // writeUserData(name)
           window.localStorage.setItem('person', uid)

            
            var promise = firebase.database().ref().child('users/' + uid).set({
                rating: 0
            });

            promise.then(() => {
                
                    window.location = 'ques.html'
                
                
            })

            
            
        }
        else {
            // No user is signed in.
        }
    });

    function wrong_user_pass() {
        document.getElementById('invalid_pass').innerHTML = 'Your username or password is invalid. Please sign up.'
        document.getElementById('invalid_pass').style.display = "block";
    }

    function invalid_email() {
        document.getElementById('invalid_pass').innerHTML = 'Your email is horrible. Please choose a valid email'
        document.getElementById('invalid_pass').style.display = "block";
    }

    function taken_email() {
        document.getElementById('invalid_pass').innerHTML = 'Sorry. This email has already been taken. Please try again'
        document.getElementById('invalid_pass').style.display = "block";
    }
    function weak_password() {
        document.getElementById('invalid_pass').innerHTML = 'Your password is too weak. It must be more than 6 characters'
        document.getElementById('invalid_pass').style.display = "block";
    }

    function writeUserData(id) {

    }


    logout()
</script>

</html>